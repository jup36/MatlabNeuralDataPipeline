
filePath = '/Volumes/Beefcake/Junchol_Data/JS2p0/WR40_082019/Matfiles'; 

if exist(fullfile(filePath,'jsTime1k_KinematicsTrajectories.mat'),'file')
    S = load(fullfile(filePath,'jsTime1k_KinematicsTrajectories.mat'));  % load jsTime1k_KV.mat
    S = S.('jkvt');
else
    error('No behavioral data found!!!')
end
clearvars 'jkvt'

%% find trials on which laser was turned on during reaching (based on hand trajectories)
stimRstartC = 0; 
for t = 1:size(S,2)
    if ~isnan(S(t).stimLaserOn) % stim trial
        
        stimRstartC = stimRstartC+1;    
        stimRstart(stimRstartC).tr = t; % stim rStart trial id 
        stimRstart(stimRstartC).stimLaserOnT = S(t).stimLaserOn; % stim laser on
        stimRstart(stimRstartC).rewarded = S(t).rewarded; % reward 
        
        stimRstart(stimRstartC).hTrjDstBase = S(t).hTrjDstBase; 
        stimRstart(stimRstartC).hTrjDstBaseTrelStim = S(t).vFrameTime-;  
        
        tmpStimRstartI = S(t).vFrameTime(S(t).hTrjRstart) > S(t).stimLaserOn & S(t).vFrameTime(S(t).hTrjRstart) < S(t).stimLaserOff; % check if reach started during laser 
        if sum(tmpStimRstartI)>0
           % detect stimRstart
           stimRstart(stimRstartC).stimRstartT = S(t).vFrameTime(S(t).hTrjRstart(tmpStimRstartI))'; % stim rStart time
           stimRstart(stimRstartC).stimRstartFrameI = S(t).hTrjRstart(tmpStimRstartI)'; % stim rStart frame indices
           % detect stimRstop
           stimRstart(stimRstartC).stimRstopT = S(t).vFrameTime(S(t).hTrjRstop(tmpStimRstartI))'; % stim rStop
           stimRstart(stimRstartC).stimRstopFrameI = S(t).hTrjRstop(tmpStimRstartI)'; % stim rStop           
        end
        


    end
end
clearvars t

figure; hold on; 
tr = stimRstart(5).tr; 
%T = S(tr).hTrjDstBaseXyz; % baseline-subtracted hand trajectory
T = S(tr).hTrjF; % baseline-subtracted hand trajectory
plot3( T(1,:), T(2,:), T(3,:) )

tr = stimRstart(7).tr; 
%T = S(tr).hTrjDstBaseXyz; % baseline-subtracted hand trajectory
T = S(tr).hTrjF; % baseline-subtracted hand trajectory
plot3( T(1,:), T(2,:), T(3,:) )

tr = stimRstart(8).tr; 
%T = S(tr).hTrjDstBaseXyz; % baseline-subtracted hand trajectory
T = S(tr).hTrjF; % baseline-subtracted hand trajectory
plot3( T(1,:), T(2,:), T(3,:) )




